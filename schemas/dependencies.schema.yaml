# Dependencies Schema
# Generated by Phase 1 (Discovery), consumed by Phase 2 (Generation)
# Validated by flowlint

# ============================================================================
# TOP-LEVEL STRUCTURE
# ============================================================================
# generated: ISO 8601      # Timestamp when file was created
# services: []             # Array of service entries (always an array, even for single service)

# ============================================================================
# SERVICE ENTRY
# ============================================================================
# services:
#   - name: "Order Service"                    # Human-readable name (Title Case)
#     target_path: "services/order/"            # Directory path analyzed
#     description: "Brief description"
#     documentation:
#       runbook: "path/to/RUNBOOK.md"
#       architecture: "path/to/architecture.md"
#       notes: "Important context"
#     entrypoints:
#       - type: "grpc" | "http" | "kafka" | "cron"
#         name: "OrderService"                  # gRPC service name, HTTP path prefix, etc.
#         methods:
#           - "CreateOrder"
#           - "GetOrder"
#     dependencies:
#       sync:
#         - name: "Payment Service"             # Target service name (Title Case)
#           type: "grpc" | "http"
#           source_file: "internal/client/payment_client.go"
#           source_line: 45
#       async:
#         - name: "order.created"               # Topic name (lowercase dot-notation)
#           direction: "produce" | "consume"
#           source_file: "internal/producer/order_producer.go"
#           source_line: 22
#     databases:                                # Peer list (not inside dependencies)
#       - name: "PostgreSQL"
#         source_file: "internal/repository/order_repo.go"
#         source_line: 12
#     caches:                                   # Peer list (not inside dependencies)
#       - name: "Redis"
#         purpose: "Order cache"
#         source_file: "internal/cache/order_cache.go"
#         source_line: 8
#     external:                                 # Per-service (not top-level)
#       - name: "Stripe API"
#         type: "https" | "grpc" | "sdk"
#         source_file: "internal/client/stripe_client.go"
#         source_line: 44
#     internal_steps:                           # OPTIONAL - ordered processing stages
#       - name: "Validate Request"
#         description: "Schema and auth validation"
#       - name: "Fetch Order Data"
#         description: "Load order from DB + cache"

# ============================================================================
# VALIDATION RULES
# ============================================================================
# 1. services MUST be an array with at least one entry
# 3. All names MUST be Title Case for services, lowercase for topics
# 4. All dependencies MUST have source_file and source_line
# 5. No abbreviations allowed in names
# 6. Topics MUST use dot-notation (e.g., "order.completed")
# 7. Every async dependency MUST specify direction
# 8. Every sync dependency MUST specify type

# ============================================================================
# FULL EXAMPLE
# ============================================================================
example:
  generated: "2024-01-15T14:30:22Z"
  services:
    - name: "Order Service"
      target_path: "services/order/"
      description: "Handles order creation, updates, and fulfillment"
      documentation:
        runbook: "services/order/docs/RUNBOOK.md"
        notes: "Core commerce service"
      entrypoints:
        - type: "grpc"
          name: "OrderService"
          methods:
            - "CreateOrder"
            - "GetOrder"
        - type: "http"
          name: "/api/v1/orders"
          methods:
            - "POST /webhook/stripe"
      dependencies:
        sync:
          - name: "Payment Service"
            type: "grpc"
            source_file: "internal/client/payment_client.go"
            source_line: 45
          - name: "Inventory Service"
            type: "grpc"
            source_file: "internal/client/inventory_client.go"
            source_line: 30
        async:
          - name: "order.created"
            direction: "produce"
            source_file: "internal/producer/order_producer.go"
            source_line: 22
          - name: "payment.completed"
            direction: "consume"
            source_file: "internal/consumer/payment_consumer.go"
            source_line: 18
      databases:
        - name: "PostgreSQL"
          source_file: "internal/repository/order_repo.go"
          source_line: 12
      caches:
        - name: "Redis"
          purpose: "Order cache for fast reads"
          source_file: "internal/cache/order_cache.go"
          source_line: 8
      external:
        - name: "Stripe API"
          type: "https"
          source_file: "internal/client/stripe_client.go"
          source_line: 44
      internal_steps:
        - name: "Validate Request"
          description: "Schema and auth validation"
        - name: "Fetch Order Data"
          description: "Load order from DB + cache"
        - name: "Process Payment"
          description: "Call payment service, handle response"
        - name: "Commit Transaction"
          description: "Write to DB, publish event"
