# Diagram Style Guide
# This file defines ALL visual conventions for generated diagrams
# These rules are NON-NEGOTIABLE - consistency is critical

# ============================================================================
# LAYOUT
# ============================================================================
layout:
  direction: "TD"  # Top-down flow (hierarchical, industry standard)

  # Node ordering (top to bottom)
  order:
    - entry_points      # API gateways, callers (TOP)
    - target_service    # The service being documented
    - dependent_services # Services this one calls
    - message_bus       # Kafka topics, queues
    - data_stores       # Databases, caches
    - external_systems  # Third-party APIs (BOTTOM)

# ============================================================================
# COLORS (Muted, professional palette)
# ============================================================================
# Softer colors for better readability and professional appearance
colors:
  # Services - soft blue
  service:
    fill: "#a5d8ff"      # Light blue
    stroke: "#339af0"
    text: "#1864ab"      # Dark blue text

  # Entry points - soft green
  entry:
    fill: "#b2f2bb"      # Light green
    stroke: "#51cf66"
    text: "#2b8a3e"      # Dark green text

  # Kafka topics - soft teal
  kafka:
    fill: "#96f2d7"      # Light teal
    stroke: "#38d9a9"
    text: "#087f5b"      # Dark teal text

  # Databases - soft amber
  database:
    fill: "#ffec99"      # Light yellow
    stroke: "#fcc419"
    text: "#e67700"      # Dark amber text

  # Caches - soft purple
  cache:
    fill: "#d0bfff"      # Light purple
    stroke: "#9775fa"
    text: "#6741d9"      # Dark purple text

  # External systems - soft gray
  external:
    fill: "#dee2e6"      # Light gray
    stroke: "#adb5bd"
    text: "#495057"      # Dark gray text

  # Error paths, DLQ - soft red
  error:
    fill: "#ffc9c9"      # Light red
    stroke: "#ff6b6b"
    text: "#c92a2a"      # Dark red text

  # Warnings - soft orange
  warning:
    fill: "#ffd8a8"      # Light orange
    stroke: "#ff922b"
    text: "#d9480f"      # Dark orange text

# ============================================================================
# NODE SHAPES
# ============================================================================
# Mermaid shape syntax reference
shapes:
  # Rectangle [text] - Services, handlers, processors
  service: "rectangle"           # [Service Name]
  handler: "rectangle"           # [Handler Name]

  # Cylinder [(text)] - Data stores, topics
  database: "cylinder"           # [(PostgreSQL)]
  kafka_topic: "cylinder"        # [(topic.name)]

  # Stadium ([text]) - Consumer groups, pools
  consumer_group: "stadium"      # ([consumer-group])

  # Double rectangle [[text]] - External systems
  external: "double_rectangle"   # [[Stripe API]]

  # Rounded rectangle (text) - Caches
  cache: "rounded"               # (Redis Cache)

  # Diamond {text} - Decisions, routers
  decision: "diamond"            # {retry?}

  # Hexagon {{text}} - Events, triggers
  event: "hexagon"               # {{cron}}

# ============================================================================
# ARROW STYLES
# ============================================================================
arrows:
  # Synchronous calls - thick solid arrow
  sync:
    style: "==>"
    description: "Caller blocks, waits for response"
    use_for:
      - "gRPC calls"
      - "HTTP/REST requests"
      - "Database queries"
      - "Cache operations"

  # Asynchronous messages - dotted arrow
  async:
    style: "-.->"
    description: "Fire and forget, processed later"
    use_for:
      - "Kafka produce"
      - "Kafka consume"
      - "RabbitMQ"
      - "SQS"
      - "Pub/Sub"

  # Internal calls - thin solid arrow
  internal:
    style: "-->"
    description: "Function call within same service"
    use_for:
      - "Method calls"
      - "Internal routing"

# ============================================================================
# LABELS
# ============================================================================
labels:
  # Arrow label format
  sync_grpc: "|gRPC: {method}|"
  sync_http: "|HTTP {verb}|"
  sync_sql: "|SQL|"
  async_produce: "|publish|"
  async_consume: "|consume|"

  # Node naming rules
  naming:
    services: "Title Case, no abbreviations"
    topics: "lowercase, dot.separated"
    databases: "Title Case (e.g., PostgreSQL)"
    methods: "PascalCase (e.g., ProcessPayment)"

# ============================================================================
# SUBGRAPHS
# ============================================================================
subgraphs:
  # Always use quoted titles
  syntax: 'subgraph id ["Display Name"]'

  # Standard subgraph IDs and names
  standard:
    - id: "entry"
      name: "Entry Points"
    - id: "target"
      name: "{service_name}"  # Replace with actual service name
    - id: "deps"
      name: "Dependencies"
    - id: "kafka"
      name: "Message Bus"
    - id: "data"
      name: "Data Stores"
    - id: "ext"
      name: "External Systems"

# ============================================================================
# MERMAID CLASS DEFINITIONS
# ============================================================================
# Copy these exactly into every diagram
classDefs: |
  classDef service fill:#a5d8ff,stroke:#339af0,color:#1864ab
  classDef entry fill:#b2f2bb,stroke:#51cf66,color:#2b8a3e
  classDef kafka fill:#96f2d7,stroke:#38d9a9,color:#087f5b
  classDef database fill:#ffec99,stroke:#fcc419,color:#e67700
  classDef cache fill:#d0bfff,stroke:#9775fa,color:#6741d9
  classDef external fill:#dee2e6,stroke:#adb5bd,color:#495057
  classDef error fill:#ffc9c9,stroke:#ff6b6b,color:#c92a2a

# ============================================================================
# LAYOUT STRATEGIES
# ============================================================================
layout_strategies:
  # Default: Grouped layout with horizontal subgraphs
  grouped:
    use_when: "3-8 dependencies, clear groupings"
    description: "Group similar nodes in subgraphs with direction LR"

  # Fallback: Linear pipeline for complex diagrams
  linear_pipeline:
    use_when: "8+ dependencies OR arrows would cross"
    description: "Hub-and-spoke pattern with target service in center"
    example: |
      flowchart TD
          Entry ==> Target
          Target ==> Dep1
          Target ==> Dep2
          Target ==> Dep3
          Target ==> Database
          Target -.-> KafkaTopic

  # Decision thresholds
  thresholds:
    use_grouped_max_deps: 8
    use_grouped_max_kafka: 4
    force_linear_on_crossing: true

# ============================================================================
# BEST PRACTICES
# ============================================================================
best_practices:
  - "Maximum 15 nodes per diagram - split if larger"
  - "Maximum 25 edges per diagram"
  - "One arrow between subgroups when possible"
  - "No crossing arrows if avoidable (reorder nodes)"
  - "All nodes must be connected (no orphans)"
  - "Legend required in every diagram"
  - "Source file references in summary table"
  - "When in doubt, use linear pipeline layout for clarity"

# ============================================================================
# ANTI-PATTERNS (DO NOT DO)
# ============================================================================
anti_patterns:
  - "Abbreviations (OrdSvc, PaySvc) - use full names"
  - "Multiple arrow styles for same type of call"
  - "Unquoted subgraph titles"
  - "Missing classDef applications"
  - "Tiny unreadable text"
  - "Giant empty subgraphs"
  - "Tangled arrow spaghetti"
  - "Orphan nodes with no connections"
  - "Inconsistent colors for same type"
  - "NEWLINES IN LABELS - all labels must be single-line"
  - "Line breaks in node text - shorten instead of wrapping"
